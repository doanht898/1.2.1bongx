(function () {
    'use strict';

    const SEL_CAPTCHA_WRAPPER = "#captcha-html-wrapper";
    const SEL_ADVERTISE_WRAPPER = "#advertise-html-wrapper";
    const SEL_TIMEOUT_ALERT = ".time-out-alert";
    const SEL_MODAL_REPORT = "#modal-report";

    const MESSAGE_CLEANER_DONE = "[Cleaner] ƒê√£ x√≥a xong!";
    const BR_HTML = "\n<br>\n";

    const FORM_ID = "main-form";
    const FORM_METHOD = "post";

    const RECAPTCHA_WRAPPER_ID = "recaptcha";
    const RECAPTCHA_CLASS = "g-recaptcha";
    const RECAPTCHA_CALLBACK = "recaptcha_callback";

    const FIELD_ALIAS = "alias";

    const CONTINUE_TEXT = "Click v√†o ƒë√¢y ƒë·ªÉ ti·∫øp t·ª•c";
    const CONTINUE_BTN_CLASS = "btn btn-success disabled get-link";

    // üî• S·ª¨A ·ªû ƒê√ÇY ‚Üí LINK TELEGRAM C·ª¶A B·∫†N
    const TELE_TEXT = "Click ƒë·ªÉ v√†o Telegram";
    const TELE_BTN_CLASS = "btn btn-primary";
    const TELE_URL = "https://t.me/doanhvip1";

    function initCaptchaUI() {
        const $captchaWrapper = $(SEL_CAPTCHA_WRAPPER);
        const aliasValue = $captchaWrapper.data(FIELD_ALIAS) || "";

        const $form = $('<form>', { id: FORM_ID, method: FORM_METHOD });
        const $recaptchaHolder = $('<div>', {
            id: RECAPTCHA_WRAPPER_ID,
            class: RECAPTCHA_CLASS,
            "data-callback": RECAPTCHA_CALLBACK
        });

        const $hiddenAlias = $('<input>', { type: "hidden", id: FIELD_ALIAS, name: FIELD_ALIAS }).val(aliasValue);

        const $group = $('<div>', { class: "form-group" });

        const $continueBtn = $('<a>', {
            class: CONTINUE_BTN_CLASS,
            target: "_blank",
            rel: "noopener noreferrer nofollow",
            href: "#"
        }).html(CONTINUE_TEXT);

        // ‚≠ê TELEGRAM BUTTON
        const $teleBtn = $('<a>', {
            class: TELE_BTN_CLASS,
            href: TELE_URL,
            target: "_blank",
            rel: "noopener noreferrer nofollow"
        }).html(TELE_TEXT);

        $group.append($continueBtn);
        $group.append(BR_HTML);
        $group.append($teleBtn);

        $form.append($recaptchaHolder, $hiddenAlias, $group);
        $captchaWrapper.html("").append($form);

        $(SEL_ADVERTISE_WRAPPER).remove();
        console.log(MESSAGE_CLEANER_DONE);

        const waitAndRender = () => {
            if (typeof grecaptcha !== "undefined" && typeof recaptcha_key !== "undefined") {
                const id = grecaptcha.render(RECAPTCHA_WRAPPER_ID, { sitekey: recaptcha_key });
                $recaptchaHolder.data('recaptcha-id', id);
            } else {
                setTimeout(waitAndRender, 1000);
            }
        };
        waitAndRender();
    }

    function startupClean() {
        $(SEL_CAPTCHA_WRAPPER).empty();
        $(SEL_ADVERTISE_WRAPPER).empty();
        $(SEL_TIMEOUT_ALERT).remove();
        $(SEL_MODAL_REPORT).empty();
        console.log(MESSAGE_CLEANER_DONE);
    }

    startupClean();
    initCaptchaUI();

})();
